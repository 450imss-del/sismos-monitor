<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Monitoreo Global de Sismos</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body {
  font-family: Arial;
  background: #0b132b;
  color: white;
  margin: 0;
}
#map {
  height: 90vh;
}
header {
  padding: 10px;
  background: #1c2541;
  text-align: center;
  font-size: 20px;
}
</style>
</head>

<body>
<header>ðŸŒŽ Monitoreo Global de Sismos en Tiempo Real</header>
<div id="map"></div>

<script>
const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

function colorMag(m) {
  if (!m) return "gray";
  if (m < 3) return "green";
  if (m < 5) return "orange";
  return "red";
}

async function cargarSismos() {
  const res = await fetch("/api/sismos");
  const data = await res.json();

  data.forEach(s => {
    if (!s.lat || !s.lon) return;

    const marker = L.circleMarker([s.lat, s.lon], {
      radius: (s.magnitud || 1) * 2,
      color: colorMag(s.magnitud),
      fillOpacity: 0.7
    }).addTo(map);

    marker.bindPopup(`
      <b>${s.fuente}</b><br>
      ${s.lugar}<br>
      Magnitud: ${s.magnitud || "N/A"}
    `);
  });
}

cargarSismos();
setInterval(cargarSismos, 60000); // refrescar cada minuto
</script>

</body>
</html>
